---
title: "WWU Classfinder Visualization"
excerpt: "Short description of portfolio item number 2 <br/><img src='/images/500x300.png'>"
collection: portfolio
---

<html>
    <head>
        <title>classfinder - image</title>
        <script src="https://cdn.jsdelivr.net/npm/d3@6" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.1" defer></script>
        <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    </head>
    <body>
        <h2 x-text>
            <div x-data="classfinder()" x-init="() => {init()}">
            <div>
                <form x-on:submit.prevent>
                    <label for="department">Department (ABBR.)</label>
                    <select name="department" x-model="department" x-on:change="reload">
                        <template x-for="name in departments" :key="name">
                            <option :value="name" x-text="name"></option>
                        </template>
                    </select>

                </form>
            </div>
            <div id="quarter-vs-tenure"></div>
            <div id="department-tenure"></div>
        </div>
    </body>
        <script>
            function classfinder() {
                return {
                    department: 'CSCI'
                    ,departments: []
                    ,orderBy: 'end_date'
                    ,urlBase: new URL( 'https://api.rivermatt.com')
                    ,tenures: []
                    ,reload: function(){
                        this.plotInit();
                    }
                    ,plotColor: function(d) { 
                        return 0
                        return d.department
                    }
                    ,endDate: function(d) { 
                        formatYear = d3.timeFormat("%Y")
                        return formatYear(new Date(d.end_date))
                    }
                    ,startDate: function(d) { 
                        formatYear = d3.timeFormat("%Y")
                        return formatYear(new Date(d.start_date))
                    }
                    ,tenure: function(d) { 
                        return d.tenure
                    }
                    ,instructor: function(d) { 
                        return d.instructor
                    }
                    ,coursesTaught: function(d) { 
                        return d.quarters_taught
                    }
                    ,plot: function() {
                        this.scatterTenure()
                    }
                    ,plotInit() {
                        plot = Plot.plot({
                            marks: [
                                Plot.dot(this.tenures, 
                                {
                                    x: this.tenure
                                    ,y: this.coursesTaught
                                    ,fill: 'grey'
                                    ,title: this.instructor
                                })
                                ,Plot.dot(this.tenures, 
                                {
                                    x: this.tenure
                                    ,y: this.coursesTaught
                                    ,r: 10
                                    ,stroke: 'red'
                                    ,filter: d => d.department === this.department
                                })
                            ]
                            ,caption: 'Plot of tenure (max minus min years) vs. teaching quarters (count of distinct quarters)'
                        })
                        plot.id = 'quarter-vs-tenure'
                        document.getElementById("quarter-vs-tenure").replaceWith(plot)

                        plot = Plot.plot({
                            marks: [
                                Plot.barX(this.tenures.filter(d => d.department === this.department), 
                                {
                                    y: this.instructor
                                    ,x: this.tenure
                                    ,fill: 'grey'
                                })
                                ,Plot.text(this.tenures.filter(d => d.department === this.department),
                                {
                                    y: this.instructor
                                    ,x: this.tenure
                                    ,text: this.tenure
                                })
                            ]
                            ,y: {
                                axis: 'right'
                                ,domain: d3.sort(this.tenures, d => d.tenure)
                                            .filter(d => d.department ===this.department)
                                            .map(d => d.instructor)
                            }
                            ,marginRight: 200
                            ,caption: 'Plot of instructor tenure (max minus min years) for a given department'
                        })
                        plot.id = 'department-tenure'
                        document.getElementById("department-tenure").replaceWith(plot)
                    }
                    ,init: function() {
                        let url = this.urlBase
                        url.pathname = '/tenure'
//                            if(this.department) {
//                                url.searchParams.set('department', 'eq.' + this.department)
//                            }
                            if(this.orderBy) {
                                url.searchParams.set('order', this.orderBy)
                            }
                            this.options = {
                                method: 'get', 
                                headers: {
                                    'Accept-Profile': 'classfinder'
                                }
                            }
                            fetch(url, this.options)
                                .then(response => {
                                    if (!response.ok) {
                                        const message = `An error has occured: ${response.status}`;
                                        throw new Error(message);  
                                    }
                                    return response.json()
                                })
                                .then(response => {
                                    this.tenures = response
                                    let departments = d3.map(response, function(d) { return d.department; }).values()
                                    departments = [...new Set(departments)].sort();
                                    this.departments = departments

                                    this.plotInit()
                                })
                        }
            }
        }
        </script>
</html>
